* Using minikube for testing

Start

#+begin_src shell :results output
  minikube start --vm-driver kvm2
#+end_src

#+RESULTS:
: * minikube v1.2.0 on linux (amd64)
:
:
: * Restarting existing kvm VM for "minikube" ...
: * Waiting for SSH access ...
: * Configuring environment for Kubernetes v1.15.0 on Docker 18.09.6
: * Relaunching Kubernetes v1.15.0 using kubeadm ...
: * Verifying: apiserver proxy etcd scheduler controller dns
: * Done! kubectl is now configured to use "minikube"

#+begin_src shell :results output
  minikube status
#+end_src

#+RESULTS:
: host: Running
: kubelet: Running
: apiserver: Running
: kubectl: Correctly Configured: pointing to minikube-vm at 192.168.42.73

Get kubernetes context

#+begin_src shell :results output
  kubectl config current-context
#+end_src

#+RESULTS:
: minikube

#+begin_src shell
  kubectl get nodes
#+end_src

#+RESULTS:
| NAME     | STATUS | ROLES  | AGE | VERSION |
| minikube | Ready  | master | 38d | v1.15.0 |

#+begin_src shell :results output
  kubectl get namespaces -A
#+end_src

#+RESULTS:
: NAME              STATUS   AGE
: default           Active   38d
: kube-node-lease   Active   38d
: kube-public       Active   38d
: kube-system       Active   38d

** Terraform Deployment

Initialize Terraform

#+begin_src shell :results none :dir kubernetes/deployment
  terraform init
#+end_src

Terraform plan

#+begin_src shell :results none :dir kubernetes/deployment
  terraform plan
#+end_src

Terraform apply

#+begin_src shell :results none :dir kubernetes/deployment
  terraform apply -auto-approve
#+end_src

Check that the namespace now exists

#+begin_src shell :results output :dir kubernetes
  kubectl get namespace -A
#+end_src

#+RESULTS:
: NAME              STATUS   AGE
: default           Active   38d
: dev               Active   79s
: kube-node-lease   Active   38d
: kube-public       Active   38d
: kube-system       Active   38d

Check that config files exist

#+begin_src shell :results output :dir kubernetes
  kubectl get configmap -n dev
#+end_src

#+RESULTS:
: NAME                                DATA   AGE
: terraform-qhub-daskgateway-config   1      104s
: terraform-qhub-jupyterhub-config    1      104s
